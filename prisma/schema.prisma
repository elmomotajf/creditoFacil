generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Loan {
  id                String   @id @default(cuid())
  friendName        String   @db.VarChar(255)
  initialValue      Decimal  @db.Decimal(12, 2)
  interestRate      Decimal  @db.Decimal(5, 2)
  latePaymentPenalty Decimal @db.Decimal(5, 2) @default(0)
  totalValue        Decimal  @db.Decimal(12, 2)
  profit            Decimal  @db.Decimal(12, 2)
  totalLateFees     Decimal  @db.Decimal(12, 2) @default(0)
  loanDate          DateTime
  finalPaymentDate  DateTime
  status            String   @default("active")
  notes             String?  @db.Text
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  installments      Installment[]

  @@map("loans")
}

model Installment {
  id                String   @id @default(cuid())
  loanId            String
  loan              Loan     @relation(fields: [loanId], references: [id], onDelete: Cascade)
  installmentNumber Int
  value             Decimal  @db.Decimal(12, 2)
  dueDate           DateTime
  paidDate          DateTime?
  status            String   @default("pending")
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  paymentProofs     PaymentProof[]

  @@unique([loanId, installmentNumber])
  @@map("installments")
}

model PaymentProof {
  id                String   @id @default(cuid())
  installmentId     String
  installment       Installment @relation(fields: [installmentId], references: [id], onDelete: Cascade)
  imageUrl          String   @db.Text
  imageKey          String   @db.VarChar(500)
  uploadedAt        DateTime @default(now())
  createdAt         DateTime @default(now())

  @@map("payment_proofs")
}
